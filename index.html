<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×•×™×§×™-××™×©×™ | ×”×’×¨×¡×” ×”××¤×•×¨×˜×ª ×•×”××œ××”</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --danger: #e74c3c; --success: #27ae60; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f6; margin: 0; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 900px; margin: auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        
        /* ×—×™×¤×•×© ×•× ×™×•×•×˜ */
        .search-section { background: #ebf3f9; padding: 20px; border-radius: 15px; margin-bottom: 30px; }
        #searchInput { width: 100%; padding: 15px; border: 2px solid var(--accent); border-radius: 10px; font-size: 18px; outline: none; }
        .suggestions-box { background: white; border: 1px solid #ccc; margin-top: 5px; border-radius: 8px; display: none; }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; font-weight: bold; }
        .suggestion-item:hover { background: #f0f7ff; color: var(--accent); }

        /* ××–×•×¨ ×”×¢×¨×™×›×” */
        .editor-section { border: 2px solid #eee; padding: 25px; border-radius: 15px; background: #fafafa; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 1.1rem; }
        input[type="text"], textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        textarea { resize: vertical; }
        
        /* ×›×¤×ª×•×¨×™× */
        .main-btn { width: 100%; padding: 18px; border: none; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; }
        .btn-save { background: var(--accent); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }
        .btn-save:hover { background: #2980b9; transform: translateY(-2px); }
        
        /* ××–×•×¨ ×”×ª×¦×•×’×” */
        #articleDisplay { display: none; animation: fadeIn 0.5s; }
        h1.display-title { font-size: 3.5rem; color: var(--primary); border-bottom: 5px solid var(--accent); padding-bottom: 10px; margin-top: 0; }
        .display-content { font-size: 1.4rem; color: #444; white-space: pre-wrap; margin: 30px 0; }
        .wiki-image { display: block; max-width: 100%; height: auto; margin: 30px auto; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        
        /* ×›×œ×™ × ×™×”×•×œ ×‘×ª×—×ª×™×ª */
        .admin-bar { display: flex; gap: 15px; margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; }
        .admin-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-size: 16px; }
        .btn-delete { background: var(--danger); }
        .btn-edit { background: var(--success); }
        .btn-back { background: #7f8c8d; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div id="editorScreen">
        <h1 style="text-align: center; color: var(--primary);">ğŸ“š ××¢×¨×›×ª ×•×™×§×™-××™×©×™</h1>
        
        <div class="search-section">
            <label>×—×¤×© ×¢×¨×š ×§×™×™×:</label>
            <input type="text" id="searchInput" placeholder="×”×§×œ×“ ×©× ×©×œ ×¢×¨×š..." oninput="handleSearch()">
            <div id="suggestionsBox" class="suggestions-box"></div>
        </div>

        <div class="editor-section">
            <h2 id="formHeader">×™×¦×™×¨×ª ×¢×¨×š ×—×“×©</h2>
            
            <div class="input-group">
                <label>×›×•×ª×¨×ª ×”×¢×¨×š:</label>
                <input type="text" id="titleInput" placeholder="×œ××©×œ: ××“×™× ×ª ×™×©×¨××œ">
            </div>

            <div class="input-group">
                <label>×”×¢×œ××ª ×ª××•× ×•×ª:</label>
                <input type="file" id="imageInput" accept="image/*" multiple>
                <p style="font-size: 0.9rem; color: #666;">× ×™×ª×Ÿ ×œ×‘×—×•×¨ ××¡×¤×¨ ×ª××•× ×•×ª. ×‘×˜×§×¡×˜ ×›×ª×•×‘ [×ª××•× ×”1] ×œ××™×§×•× ×”×ª××•× ×” ×”×¨××©×•× ×”.</p>
            </div>

            <div class="input-group">
                <label>×ª×•×›×Ÿ ×”×¢×¨×š:</label>
                <textarea id="contentInput" rows="12" placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×›×œ ×”××™×“×¢..."></textarea>
            </div>

            <button class="main-btn btn-save" onclick="startSavingProcess()">ğŸ’¾ ×©××•×¨ ×¢×¨×š (×“×•×¨×© ×§×•×“ 5439)</button>
        </div>
    </div>

    <div id="articleDisplay">
        <h1 id="displayTitle" class="display-title"></h1>
        <div id="displayContent" class="display-content"></div>
        
        <div class="admin-bar">
            <button class="admin-btn btn-back" onclick="window.location.reload()">×—×–×•×¨ ×œ×—×™×¤×•×©</button>
            <button class="admin-btn btn-edit" onclick="initEditMode()">×¢×¨×•×š ×¢×¨×š âœï¸</button>
            <button class="admin-btn btn-delete" onclick="initDeleteMode()">××—×§ ×¢×¨×š ğŸ—‘ï¸</button>
        </div>
    </div>
</div>

<script>
    // ×”×’×“×¨×•×ª ×§×‘×•×¢×•×ª
    const DB_PREFIX = 'WIKI_PRO_';
    const ADMIN_PASSWORD = "5439";
    let currentViewingTitle = "";

    // 1. ×¤×•× ×§×¦×™×™×ª ×”×—×™×¤×•×©
    function handleSearch() {
        const query = document.getElementById('searchInput').value.trim().toLowerCase();
        const box = document.getElementById('suggestionsBox');
        box.innerHTML = '';

        if (query === '') {
            box.style.display = 'none';
            return;
        }

        let matchCount = 0;
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith(DB_PREFIX)) {
                const title = key.replace(DB_PREFIX, '');
                if (title.toLowerCase().includes(query)) {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerText = title;
                    item.onclick = function() { displayArticle(title); };
                    box.appendChild(item);
                    matchCount++;
                }
            }
        }
        box.style.display = matchCount > 0 ? 'block' : 'none';
    }

    // 2. ×¤×•× ×§×¦×™×™×ª ×”×¦×’×ª ×”×¢×¨×š
    function displayArticle(title) {
        currentViewingTitle = title;
        const rawData = localStorage.getItem(DB_PREFIX + title);
        const data = JSON.parse(rawData);

        document.getElementById('editorScreen').style.display = 'none';
        document.getElementById('articleDisplay').style.display = 'block';
        document.getElementById('displayTitle').innerText = title;

        let formattedText = data.content;
        
        // ×”×—×œ×¤×ª ×§×•×“×™ ×ª××•× ×•×ª
        if (data.images && data.images.length > 0) {
            for (let i = 0; i < data.images.length; i++) {
                const placeholder = "[×ª××•× ×”" + (i + 1) + "]";
                const imageTag = '<img src="' + data.images[i] + '" class="wiki-image">';
                formattedText = formattedText.split(placeholder).join(imageTag);
            }
        }

        // ×˜×™×¤×•×œ ×‘×™×¨×™×“×•×ª ×©×•×¨×”
        formattedText = formattedText.replace(/\n/g, '<br>');
        document.getElementById('displayContent').innerHTML = formattedText;
    }

    // 3. ×ª×”×œ×™×š ×”×©××™×¨×” ×”××¤×•×¨×˜
    async function startSavingProcess() {
        const title = document.getElementById('titleInput').value.trim();
        const content = document.getElementById('contentInput').value.trim();
        const imageFiles = document.getElementById('imageInput').files;

        // ×‘×“×™×§×•×ª ×‘×¡×™×¡×™×•×ª
        if (title === "" || content === "") {
            alert("×©×’×™××”: ×—×™×™×‘×™× ×œ××œ× ×’× ×›×•×ª×¨×ª ×•×’× ×ª×•×›×Ÿ.");
            return;
        }

        // ×‘×“×™×§×ª ×§×•×“ ×× ×”×œ
        const passwordGuess = prompt("×”×–×Ÿ ×§×•×“ ×× ×”×œ (5439) ×œ××™×©×•×¨ ×”×©××™×¨×”:");
        if (passwordGuess !== ADMIN_PASSWORD) {
            alert("×§×•×“ ×©×’×•×™! ×”×©××™×¨×” ×‘×•×˜×œ×”.");
            return;
        }

        // ×¢×™×‘×•×“ ×ª××•× ×•×ª
        let processedImages = [];
        if (imageFiles.length > 0) {
            alert("××¢×‘×“ " + imageFiles.length + " ×ª××•× ×•×ª, ×× × ×”××ª×Ÿ...");
            for (let i = 0; i < imageFiles.length; i++) {
                const base64Image = await compressImageFile(imageFiles[i]);
                processedImages.push(base64Image);
            }
        } else {
            // ×× ×× ×—× ×• ×‘×¢×¨×™×›×” ×•×œ× ×”×¢×œ× ×• ×ª××•× ×•×ª ×—×“×©×•×ª, × × ×¡×” ×œ×©××•×¨ ×¢×œ ×”×™×©× ×•×ª
            const existingData = localStorage.getItem(DB_PREFIX + title);
            if (existingData) {
                processedImages = JSON.parse(existingData).images;
            }
        }

        // ×‘× ×™×™×ª ×”××•×‘×™×™×§×˜ ×”×¡×•×¤×™
        const finalArticleObject = {
            content: content,
            images: processedImages,
            lastUpdated: new Date().getTime()
        };

        // × ×™×¡×™×•×Ÿ ×©××™×¨×” ×œ×–×™×›×¨×•×Ÿ
        try {
            localStorage.setItem(DB_PREFIX + title, JSON.stringify(finalArticleObject));
            alert("×”×¢×¨×š '" + title + "' × ×©××¨ ×‘×”×¦×œ×—×” ×‘××¢×¨×›×ª!");
            window.location.reload(); // ×¨×¢× ×•×Ÿ ×”×“×£ ×œ×¡× ×›×¨×•×Ÿ
        } catch (error) {
            console.error(error);
            alert("×©×’×™××” ×§×¨×™×˜×™×ª: ×œ× × ×™×ª×Ÿ ×œ×©××•×¨. ×›× ×¨××” ×©×”×ª××•× ×•×ª ×’×“×•×œ×•×ª ××“×™ ×œ×–×™×›×¨×•×Ÿ ×”×“×¤×“×¤×Ÿ.");
        }
    }

    // 4. ×¤×•× ×§×¦×™×™×ª ×›×™×•×•×¥ ×ª××•× ×•×ª ××¤×•×¨×˜×ª
    function compressImageFile(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; // ×’×•×“×œ ××§×¡×™××œ×™ ×œ×¨×•×—×‘
                    const scaleFactor = MAX_WIDTH / img.width;
                    
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleFactor;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // ×”××¨×” ×œ×¤×•×¨××˜ JPEG ×¢× ××™×›×•×ª ×©×œ 60% ×œ×—×¡×›×•×Ÿ ×‘××§×•×
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.6);
                    resolve(compressedDataUrl);
                };
            };
        });
    }

    // 5. × ×™×”×•×œ ××—×™×§×”
    function initDeleteMode() {
        const pass = prompt("×”×–×Ÿ ×§×•×“ ×× ×”×œ ×œ××—×™×§×ª ×”×¢×¨×š:");
        if (pass === ADMIN_PASSWORD) {
            if (confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª '" + currentViewingTitle + "'? ×¤×¢×•×œ×” ×–×• ××™× ×” ×”×¤×™×›×”.")) {
                localStorage.removeItem(DB_PREFIX + currentViewingTitle);
                alert("×”×¢×¨×š × ××—×§.");
                window.location.reload();
            }
        } else {
            alert("×§×•×“ ×©×’×•×™.");
        }
    }

    // 6. × ×™×”×•×œ ×¢×¨×™×›×”
    function initEditMode() {
        const pass = prompt("×”×–×Ÿ ×§×•×“ ×× ×”×œ ×œ×¢×¨×™×›×ª ×”×¢×¨×š:");
        if (pass === ADMIN_PASSWORD) {
            const rawData = localStorage.getItem(DB_PREFIX + currentViewingTitle);
            const data = JSON.parse(rawData);

            document.getElementById('articleDisplay').style.display = 'none';
            document.getElementById('editorScreen').style.display = 'block';

            document.getElementById('titleInput').value = currentViewingTitle;
            document.getElementById('contentInput').value = data.content;
            document.getElementById('formHeader').innerText = "×¢×¨×™×›×ª ×¢×¨×š ×§×™×™×";
            
            window.scrollTo(0, 0);
        } else {
            alert("×§×•×“ ×©×’×•×™.");
        }
    }
</script>

</body>
</html>
